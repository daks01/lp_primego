import React, { useEffect, useRef, useState } from 'react';
import { useStore } from '@nanostores/react';
import { $selectedOrOnlyRecommendedSize, $selectedProduct } from '../../../stores/fittingProductStore.ts';
import styles from './MeasurementsIllustration.module.scss';
import cn from 'classnames';
import { useTranslations } from '../../../i18n/utils';

const lang = document.documentElement.lang;
const t = useTranslations(lang);

interface Props {
    showOn?: 'mobile' | 'desktop';
    withoutSole?: boolean;
    className?: string;
    warning?: any;
}
function MeasurementsIllustration({ showOn, withoutSole, className, warning }: Props) {
    const store = useStore($selectedProduct);
    const selectedOrOnlyRecommended = useStore($selectedOrOnlyRecommendedSize);
    const containerRef = useRef<HTMLDivElement>(null);
    const containerHeightForOldBrowsers = {
        '--height': `${containerRef.current?.offsetHeight}px`,
    } as React.CSSProperties;
    const isNotSame = store.recommended && store.size && store.recommended !== store.size;
    const isWarning = isNotSame && !store.selectedSizeApproval;
    const isMobile = useMobileMediaQuery();
    const visible = getVisible({ showOn, isMobile });
    if (!visible) return null;
    return (
        <div className={cn(styles.measurements, className)}>
            <div className={styles.measurements__presentation} ref={containerRef} style={containerHeightForOldBrowsers}>
                <div className={styles.measurements__presentation__coords}>
                    <svg
                        width="100%"
                        height="100%"
                        viewBox="0 0 450 792"
                        focusable="false"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M91.925 13.126c-1.008 0-1.908-.21-2.7-.63a4.806 4.806 0 0 1-1.836-1.764c-.444-.744-.666-1.59-.666-2.538 0-.96.222-1.806.666-2.538a4.676 4.676 0 0 1 1.836-1.746c.792-.42 1.692-.63 2.7-.63.936 0 1.758.192 2.466.576.72.372 1.266.924 1.638 1.656L94.301 6.52c-.288-.456-.642-.792-1.062-1.008a2.803 2.803 0 0 0-1.332-.324c-.552 0-1.05.12-1.494.36-.444.24-.792.588-1.044 1.044-.252.444-.378.978-.378 1.602 0 .624.126 1.164.378 1.62.252.444.6.786 1.044 1.026.444.24.942.36 1.494.36.48 0 .924-.108 1.332-.324.42-.216.774-.552 1.062-1.008l1.728 1.008a3.936 3.936 0 0 1-1.638 1.674c-.708.384-1.53.576-2.466.576ZM98.01 13V3.388h2.358l3.87 6.822h-.936l4.068-6.822h2.106l.018 9.612h-2.034V5.8l.36.234-3.6 5.958h-.972l-3.618-6.12.432-.108V13H98.01Zm332.915 687.126c-1.008 0-1.908-.21-2.7-.63a4.806 4.806 0 0 1-1.836-1.764c-.444-.744-.666-1.59-.666-2.538 0-.96.222-1.806.666-2.538a4.676 4.676 0 0 1 1.836-1.746c.792-.42 1.692-.63 2.7-.63.936 0 1.758.192 2.466.576.72.372 1.266.924 1.638 1.656l-1.728 1.008c-.288-.456-.642-.792-1.062-1.008a2.803 2.803 0 0 0-1.332-.324c-.552 0-1.05.12-1.494.36-.444.24-.792.588-1.044 1.044-.252.444-.378.978-.378 1.602 0 .624.126 1.164.378 1.62.252.444.6.786 1.044 1.026.444.24.942.36 1.494.36.48 0 .924-.108 1.332-.324.42-.216.774-.552 1.062-1.008l1.728 1.008a3.936 3.936 0 0 1-1.638 1.674c-.708.384-1.53.576-2.466.576Zm6.085-.126v-9.612h2.358l3.87 6.822h-.936l4.068-6.822h2.106l.018 9.612h-2.034v-7.2l.36.234-3.6 5.958h-.972l-3.618-6.12.432-.108V700h-2.052Z"
                            fill="var(--color-gray)"
                        ></path>
                        <path
                            d="M6.492 664.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468Zm-1.28-88.966a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234H1.414l.648-6.858H9.46v1.962H2.926l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558ZM2.825 483v-11.7l1.026 1.062H.16V470.4h5.004V483h-2.34Zm10.095.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM3.124 393v-11.7l1.026 1.062H.46V380.4h5.004V393h-2.34Zm9.016.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234H8.342l.648-6.858h7.398v1.962H9.854l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558ZM.836 303v-1.566l5.004-4.752c.42-.396.732-.744.936-1.044.204-.3.336-.576.396-.828.072-.264.108-.51.108-.738 0-.576-.198-1.02-.594-1.332-.396-.324-.978-.486-1.746-.486-.612 0-1.17.108-1.674.324a3.385 3.385 0 0 0-1.278.99l-1.638-1.26c.492-.66 1.152-1.17 1.98-1.53.84-.372 1.776-.558 2.808-.558.912 0 1.704.15 2.376.45.684.288 1.206.702 1.566 1.242.372.54.558 1.182.558 1.926 0 .408-.054.816-.162 1.224-.108.396-.312.816-.612 1.26-.3.444-.738.942-1.314 1.494l-4.302 4.086-.486-.882h7.362V303H.836Zm15.895.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM.636 213v-1.566l5.004-4.752c.42-.396.732-.744.936-1.044.204-.3.336-.576.396-.828.072-.264.108-.51.108-.738 0-.576-.198-1.02-.594-1.332-.396-.324-.978-.486-1.746-.486-.612 0-1.17.108-1.674.324a3.385 3.385 0 0 0-1.278.99l-1.638-1.26c.492-.66 1.152-1.17 1.98-1.53.84-.372 1.776-.558 2.808-.558.912 0 1.704.15 2.376.45.684.288 1.206.702 1.566 1.242.372.54.558 1.182.558 1.926 0 .408-.054.816-.162 1.224-.108.396-.312.816-.612 1.26-.3.444-.738.942-1.314 1.494l-4.302 4.086-.486-.882h7.362V213H.636Zm14.814.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.398v1.962h-6.534l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558Zm-10.492-90a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l1.008-1.818c.456.372 1.008.672 1.656.9a6.083 6.083 0 0 0 2.034.342c.84 0 1.494-.168 1.962-.504.468-.348.702-.816.702-1.404 0-.576-.216-1.032-.648-1.368-.432-.336-1.128-.504-2.088-.504H3.698v-1.602l3.6-4.284.306.882H.836V110.4h8.586v1.566l-3.6 4.284-1.224-.72H5.3c1.548 0 2.706.348 3.474 1.044.78.684 1.17 1.566 1.17 2.646 0 .708-.18 1.362-.54 1.962-.36.6-.912 1.086-1.656 1.458-.732.36-1.662.54-2.79.54Zm11.773 0c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM4.846 33.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l1.008-1.818c.456.372 1.008.672 1.656.9a6.083 6.083 0 0 0 2.034.342c.84 0 1.494-.168 1.962-.504.468-.348.702-.816.702-1.404 0-.576-.216-1.032-.648-1.368-.432-.336-1.128-.504-2.088-.504H3.586v-1.602l3.6-4.284.306.882H.724V20.4H9.31v1.566l-3.6 4.284-1.224-.72h.702c1.548 0 2.706.348 3.474 1.044.78.684 1.17 1.566 1.17 2.646 0 .708-.18 1.362-.54 1.962-.36.6-.912 1.086-1.656 1.458-.732.36-1.662.54-2.79.54Zm10.517 0a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.549-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.655.9a6.24 6.24 0 0 0 2.053.342c.827 0 1.475-.174 1.943-.522.48-.348.72-.816.72-1.404 0-.396-.101-.744-.305-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.397v1.962h-6.534l1.224-1.116-.486 5.13-1.223-1.098h2.538c1.248 0 2.25.168 3.005.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.655 1.476-.732.372-1.662.558-2.79.558Z"
                            fill="currentColor"
                        ></path>
                        <path
                            d="M111 27H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m375 34v72m-9-72v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v72m0-72v72m-9-72v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v72m0-72v72m-9-72v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v72"
                            stroke="var(--color-product-primego)"
                            strokeWidth="2"
                            strokeLinecap="round"
                        ></path>
                        <path
                            d="M143.048 791.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468Zm88.92 2.034a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.398v1.962h-6.534l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558Zm85.857-.18v-11.7l1.026 1.062h-3.69V778.4h5.004V791h-2.34Zm10.095.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM407.124 791v-11.7l1.026 1.062h-3.69V778.4h5.004V791h-2.34Zm9.016.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.398v1.962h-6.534l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558Z"
                            fill="currentColor"
                        ></path>
                    </svg>
                </div>
                <div className={styles.measurements__preview}>
                    {!selectedOrOnlyRecommended || withoutSole ? null : (
                        <div
                            className={cn(styles.measurements__preview__shoeSole, {
                                [styles.fit]: selectedOrOnlyRecommended.isFit,
                            })}
                            style={
                                {
                                    '--length': selectedOrOnlyRecommended.size.length?.toString() ?? null,
                                    '--width': selectedOrOnlyRecommended.size.width?.toString() ?? null,
                                } as React.CSSProperties
                            }
                        >
                            <svg
                                preserveAspectRatio="none"
                                width="100%"
                                height="100%"
                                viewBox="0 0 244 576"
                                focusable="false"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <mask
                                    id="a"
                                    style={{ maskType: 'alpha' }}
                                    maskUnits="userSpaceOnUse"
                                    x="4"
                                    y="1"
                                    width="231"
                                    height="573"
                                >
                                    <path
                                        d="M229.115 175.781c17.897-100-11.014-206.9-117.671-164.79C-31.449 67.41 1.615 259.78 27.615 484.778c9.183 79.46 75.5 111.76 119.5 70.505 32-30.004 42-70.505 46.5-209 1.235-37.981 19.866-83.141 35.5-170.501Z"
                                        fill="currentColor"
                                    ></path>
                                </mask>
                                <g mask="url(#a)" fill="currentColor" fillOpacity=".4">
                                    <rect height="576" width="244"></rect>
                                    <path
                                        opacity=".15"
                                        d="M191.125 360.576c0-4.384 1.142-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.222-4.783h26.437v15.943h-26.437v36.67l21.682-8.769 4.755 13.95-26.437 10.762v41.053h26.437v14.947h-41.083V360.576ZM120.172 360.576c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h16.548l3.043 4.584 2.853-4.584h15.786c5.199.133 8.94 1.727 11.222 4.783s3.424 6.776 3.424 11.16v108.613h-14.646V360.576h-11.792v108.613H146.61V360.576h-11.793v108.613h-14.645V360.576ZM102.156 469.189V344.633h14.645v124.556h-14.645ZM57.578 344.633h26.437c5.199.133 8.94 1.727 11.222 4.783s3.424 6.776 3.424 11.16v21.922c0 4.385-.254 8.769-.761 13.153-.38 4.252-2.156 7.374-5.326 9.367l-5.706 2.391 11.793 61.78H84.014l-11.792-60.783v60.783H57.578V344.633Zm14.645 15.943v36.67l11.792-4.783v-31.887H72.223ZM27.645 360.576v36.67l11.793-4.783v-31.887H27.645Zm11.793-15.943c5.198.133 8.939 1.727 11.221 4.783 2.283 3.056 3.424 6.776 3.424 11.16v21.922c0 4.385-.254 8.769-.76 13.153-.381 4.252-2.156 7.374-5.326 9.367l-20.352 8.171v56H13V344.633h26.438ZM169.281 493.736c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h11.793c5.199.133 8.939 1.727 11.221 4.783 2.283 3.056 3.424 6.776 3.424 11.16v93.666c0 5.846-.444 9.832-1.331 11.957-.888 1.993-2.41 2.99-4.565 2.99h-29.291c-2.155 0-3.677-.997-4.564-2.99-.888-2.125-1.332-6.111-1.332-11.957v-93.666Zm14.645 93.666h11.793v-93.666h-11.793v93.666ZM151.14 477.793c5.199.133 8.94 1.727 11.222 4.783 2.283 3.056 3.424 6.776 3.424 11.16v15.146H151.14v-15.146h-11.792v93.666h11.792v-45.239l-6.086 1.993v-16.541l20.732-6.775v66.562c0 5.846-.444 9.832-1.332 11.957-.887 1.993-2.409 2.99-4.564 2.99h-35.187V477.793h26.437ZM80.126 493.736c0-4.384 1.14-8.104 3.423-11.16 2.282-3.056 6.023-4.65 11.222-4.783h26.437v15.943H94.771v36.669l21.682-8.768 4.755 13.95-26.437 10.762v41.053h26.437v14.947H80.126V493.736ZM9.172 493.736c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h16.548l3.043 4.584 2.853-4.584h15.786c5.2.133 8.94 1.727 11.222 4.783s3.424 6.776 3.424 11.16v108.613H62.047V493.736H50.255v108.613H35.61V493.736H23.817v108.613H9.172V493.736ZM-8.844 602.349V477.793H5.8v124.556H-8.844ZM233.281 227.056c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h11.793c5.199.133 8.939 1.727 11.221 4.783 2.283 3.056 3.424 6.776 3.424 11.16v93.666c0 5.846-.444 9.832-1.331 11.957-.888 1.993-2.41 2.99-4.565 2.99h-29.291c-2.155 0-3.677-.997-4.564-2.99-.888-2.125-1.332-6.111-1.332-11.957v-93.666Zm14.645 93.666h11.793v-93.666h-11.793v93.666ZM215.14 211.113c5.199.133 8.94 1.727 11.222 4.783 2.283 3.056 3.424 6.776 3.424 11.16v15.146H215.14v-15.146h-11.792v93.666h11.792v-45.239l-6.086 1.993v-16.541l20.732-6.775v66.562c0 5.846-.444 9.832-1.332 11.957-.887 1.993-2.409 2.99-4.564 2.99h-35.187V211.113h26.437ZM144.125 227.056c0-4.384 1.142-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.222-4.783h26.437v15.943h-26.437v36.669l21.682-8.768 4.755 13.95-26.437 10.762v41.053h26.437v14.947h-41.083V227.056ZM73.172 227.056c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h16.548l3.043 4.584 2.853-4.584h15.786c5.199.133 8.94 1.727 11.222 4.783s3.424 6.776 3.424 11.16v108.613h-14.646V227.056h-11.792v108.613H99.61V227.056H87.817v108.613H73.172V227.056ZM55.156 335.669V211.113H69.8v124.556H55.156ZM10.578 211.113h26.437c5.199.133 8.94 1.727 11.222 4.783s3.423 6.776 3.423 11.16v21.922c0 4.384-.253 8.769-.76 13.153-.38 4.252-2.156 7.374-5.326 9.367l-5.706 2.391 11.792 61.78H37.016l-11.792-60.783v60.783H10.578V211.113Zm14.645 15.943v36.669l11.792-4.782v-31.887H25.223ZM-19.355 227.056v36.669l11.793-4.782v-31.887h-11.793Zm11.793-15.943c5.198.133 8.94 1.727 11.221 4.783 2.283 3.056 3.424 6.776 3.424 11.16v21.922c0 4.384-.254 8.769-.76 13.153-.381 4.252-2.156 7.374-5.326 9.367l-20.352 8.171v56H-34V211.113h26.438ZM198.125 93.479c0-4.384 1.142-8.105 3.424-11.16 2.282-3.056 6.023-4.65 11.222-4.783h26.437v15.943h-26.437v36.669l21.682-8.769 4.755 13.951-26.437 10.761v41.054h26.437v14.946h-41.083V93.479ZM127.172 93.479c0-4.384 1.141-8.105 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h16.548l3.043 4.584 2.853-4.584h15.786c5.199.133 8.94 1.727 11.222 4.783 2.282 3.055 3.424 6.776 3.424 11.16V202.09h-14.646V93.479h-11.792V202.09H153.61V93.479h-11.793V202.09h-14.645V93.479ZM109.156 202.091V77.536h14.645V202.09h-14.645ZM64.578 77.536h26.437c5.199.133 8.94 1.727 11.222 4.783 2.282 3.055 3.424 6.776 3.424 11.16V115.4c0 4.384-.254 8.768-.761 13.153-.381 4.251-2.156 7.373-5.326 9.366l-5.706 2.392 11.793 61.779H91.015l-11.792-60.783v60.783H64.578V77.536Zm14.645 15.943v36.669l11.792-4.783V93.479H79.223ZM34.645 93.479v36.669l11.793-4.783V93.479H34.645Zm11.793-15.943c5.198.133 8.939 1.727 11.221 4.783 2.283 3.055 3.424 6.776 3.424 11.16V115.4c0 4.384-.254 8.768-.76 13.153-.381 4.251-2.156 7.373-5.326 9.366l-20.352 8.171v56H20V77.536h26.438ZM245.451-56.582c5.199.133 8.939 1.727 11.222 4.783 2.282 3.056 3.423 6.776 3.423 11.16v15.146h-14.645v-15.146h-11.792v93.666h11.792V7.788l-6.086 1.993v-16.54l20.731-6.776v66.562c0 5.846-.443 9.832-1.331 11.957-.888 1.993-2.409 2.99-4.565 2.99h-35.187V-56.582h26.438ZM174.436-40.639c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h26.438v15.943h-26.438v36.67l21.683-8.77 4.755 13.951-26.438 10.762v41.053h26.438v14.947h-41.083V-40.64ZM103.483-40.639c0-4.384 1.141-8.104 3.423-11.16 2.283-3.056 6.023-4.65 11.222-4.783h16.547l3.043 4.584 2.853-4.584h15.787c5.199.133 8.939 1.727 11.222 4.783 2.282 3.056 3.423 6.776 3.423 11.16V67.974h-14.645V-40.64h-11.792V67.974H129.92V-40.64h-11.792V67.974h-14.645V-40.64ZM85.466 67.974V-56.582h14.646V67.974H85.466ZM40.888-56.582h26.438c5.199.133 8.94 1.727 11.222 4.783s3.423 6.776 3.423 11.16v21.922c0 4.384-.254 8.769-.76 13.153-.381 4.252-2.156 7.374-5.326 9.367l-5.706 2.391 11.792 61.78H67.326L55.534 7.19v60.783H40.887V-56.582Zm14.645 15.943v36.67l11.793-4.783V-40.64H55.534ZM10.956-40.639v36.67l11.792-4.783V-40.64H10.956Zm11.792-15.943c5.199.133 8.94 1.727 11.222 4.783s3.424 6.776 3.424 11.16v21.922c0 4.384-.254 8.769-.761 13.153-.38 4.252-2.156 7.374-5.326 9.367l-20.351 8.17v56H-3.689V-56.581h26.437Z"
                                    ></path>
                                </g>
                            </svg>
                        </div>
                    )}
                    <div
                        className={styles.measurements__preview__foot}
                        style={
                            {
                                '--length': store.length?.toString() ?? null,
                                '--width': store.width?.toString() ?? null,
                            } as React.CSSProperties
                        }
                    >
                        {!store.length ? null : (
                            <div className={cn(styles.measurement__tooltip, styles.yTooltip)}>
                                <span>{toCm(store.length)?.toFixed(1)}</span>
                                <svg
                                    className={styles.measurement__tooltip__arrow}
                                    focusable="false"
                                    aria-hidden="true"
                                    width="12"
                                    height="6"
                                    viewBox="0 0 12 16"
                                >
                                    <path stroke="none" d="M0,0 H12 L6,6 Q6,6 6,6 Z"></path>
                                </svg>
                            </div>
                        )}
                        {!store.width ? null : (
                            <div className={cn(styles.measurement__tooltip, styles.xTooltip)}>
                                <span>{toCm(store.width)?.toFixed(1)}</span>
                                <svg
                                    className={styles.measurement__tooltip__arrow}
                                    focusable="false"
                                    aria-hidden="true"
                                    width="12"
                                    height="6"
                                    viewBox="0 0 12 16"
                                >
                                    <path stroke="none" d="M0,0 H12 L6,6 Q6,6 6,6 Z"></path>
                                </svg>
                            </div>
                        )}
                        <svg
                            preserveAspectRatio="none"
                            width="100%"
                            height="100%"
                            focusable="false"
                            viewBox="0 0 197 590"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M131.595 113.106c-2.767-5.202-5.533-10.403-8.082-15.418-.548.279-1.123.349-1.481.605l1.725 14.269c11.522 6.912 22.146 19.256 38.492 13.025l.329 2.728c-2.605.953-5.491 2.792-7.866 2.44-6.981-1.5-14.347-2.953-20.574-6.246-10.387-5.56-20.864-10.256-32.174-10.594-4.481-.098-9.818.759-12.987 3.484-13.197 11.387-25.934 23.356-38.021 35.886-8.306 8.455-15.042 18.636-22.888 27.674-1.712 1.91-6.04 3.071-7.917 2.019-3.776-2.312-1.693-5.97.493-8.788 5.891-7.525 12-14.862 17.483-22.55 1.163-1.63 1.931-4.917 1.32-6.759-2.344-6.53-5.07-13.014-8.487-18.776-1.912-2.963-5.548-5.718-8.93-6.374-4.8-1.123-8.3 2.067-10.207 7.193-4.799 13.354-3.29 27.437-2.192 41.356.29 4.011.989 8.184 1.496 12.381-.549.279-1.315.372-1.864.651-1.248-3.895-2.662-7.556-3.527-11.497-3.053-12.406-4.166-24.833-1.782-37.257 2.205-10.699 6.004-19.46 18.438-19.471.103-16.832.666-33.08 21.502-34.318.359-17.927 3.92-33.473 23.43-36.042C68.7 30 71.55 26.25 81.738 23.742c16.408-4.11 17.033-3.76 23.013 5.525 2.023-5.78 3.191-13.798 7.255-18.76 4.421-5.217 11.509-9.266 18.021-10.053 14.121-2.13 26.615 3.175 35.093 17.056 5.813 9.517 10.937 19.757 16.559 29.298 8.797 14.907 7.06 31.266 6.906 47.678-.305 32.438 19.083 79.704 0 125.624-17.712 42.622-39.32 85.071-36.019 131.224 4.585 62.438 62.452 199.452-3.199 231.252-35.006 16.956-60.7 2.919-74.857-22.805-15.82-28.743-18.395-71.019-27.625-124.822C29.66 334.545 11.246 282.135.038 234.926c-.47-2.285 3.555-.886 4.404 2.001 12.81 43.608 36.027 116.021 48.448 188.43 9.266 54.014 12.826 99.804 28.426 128.823 12.64 23.514 35.515 37.835 65.506 21.204 62.048-34.406.704-164.722-3.462-224.05-2.827-39.472 14.38-77.292 35.887-124.685 28.022-61.749-.8-101.062 3.111-150.116.149-10.025-2.474-18.863-7.178-27.238-5.188-9.167-10.21-18.567-15.565-27.501C149.532 4.275 128.33.873 115.961 14.288c-1.713 1.91-3.489 4.892-3.734 7.69-.571 11.353-.568 22.636-.73 34.153-.267 13.872 4.485 25.86 11.867 37.104 2.856 4.34 5.188 9.167 7.329 14.019.969 1.585.673 3.963.902 5.852Zm-43.196-6.921c9.804.732 19.608 1.465 29.387 1.988.791-14.36.407-14.314-5.57-26.793-2.842-5.83-5.428-12.758-5.423-19.145-.029-11.494-4.31-21.196-9-31.063-.777-1.61-3.354-3.64-4.861-3.245-4.979.6-10.1 1.644-14.71 3.69-5.351 2.35-6.237 9.483-2.706 14.592C86.521 61.7 93.414 78.54 88.661 98.701c-.487 2.401-.158 5.129-.262 7.484-.47-2.286-1.375-4.945-1.679-7.463-.468-5.478.572-11.352-1.02-16.483-2.673-9.258-7.045-18.1-10.46-27.054-2.266-5.9-6.057-6.72-10.96-5.49-8.11 2.043-12.263 7.866-13.904 16.793-1.526 8.275-2.337 16.038 6.774 20.687 2.068 1.028 3.687 3.174 5.614 4.645 4.988 4.295 6.388 9.448 4.275 16.09-1.548 4.871-2.28 10.07-3.42 15.103.433.374.867.748 1.468.888 7.817-6.053 15.66-11.896 23.312-17.716Zm-46.208 40.494c4.139-4.332 7.296-8.758 11.447-11.389 6.489-4.19 7.528-10.063 8.964-17.475 2.642-13.52-.747-22.265-12.053-28.991-6.903-4.064-13.783-4.724-18.346.937-4.396 5.427-5.75 21.559-2.652 26.294 3.341 5.133 6.183 10.964 8.616 16.632 1.848 4.034 2.598 8.628 4.024 13.992Z"
                                fill="currentColor"
                            ></path>
                        </svg>
                    </div>
                </div>
            </div>
            {withoutSole ? null : (
                <>
                    <div className={styles.recommendedSize}>
                        {t("fitting.Ваш рекомендованный размер")}: <span>{store.recommended ?? '-'}</span>
                    </div>
                    {isWarning ? <div className={styles.warning}>{warning}</div> : null}
                </>
            )}
        </div>
    );
}

const useMobileMediaQuery = () => {
    const mediaQuery = window.matchMedia('screen and (max-width: 1023px)');
    const [match, setMatch] = useState(mediaQuery.matches);

    useEffect(() => {
        const onChange = () => setMatch(mediaQuery.matches);
        mediaQuery.addEventListener('change', onChange);
        return () => mediaQuery.removeEventListener('change', onChange);
    }, [mediaQuery]);

    return match;
};

const getVisible = ({ showOn, isMobile }: Pick<Props, 'showOn'> & { isMobile: boolean }) => {
    switch (showOn) {
        case 'mobile':
            return isMobile;
        case 'desktop':
            return !isMobile;
        default:
            return true;
    }
};

function toCm(valueInMm: number | undefined) {
    if (!valueInMm) return undefined;
    return valueInMm / 10;
}

export default MeasurementsIllustration;
