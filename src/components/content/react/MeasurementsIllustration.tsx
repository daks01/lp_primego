import React, { useEffect, useRef, useState } from 'react';
import { useStore } from '@nanostores/react';
import { $selectedOrOnlyRecommendedSize, $selectedProduct } from '../../../stores/fittingProductStore.ts';
import styles from './MeasurementsIllustration.module.scss';
import cn from 'classnames';
import { useTranslations } from '../../../i18n/utils';

const lang = document.documentElement.lang as 'en' | 'ru';
const t = useTranslations(lang);

interface Props {
    sku: string;
    showOn?: 'mobile' | 'desktop';
    withoutSole?: boolean;
    className?: string;
    warning?: any;
}
function MeasurementsIllustration({ showOn, withoutSole, className, warning, sku }: Props) {
    const store = useStore($selectedProduct);
    const selectedOrOnlyRecommended = useStore($selectedOrOnlyRecommendedSize);
    const containerRef = useRef<HTMLDivElement>(null);
    const containerHeightForOldBrowsers = {
        '--height': `${containerRef.current?.offsetHeight}px`,
    } as React.CSSProperties;
    const isNotSame = store.recommended && store.size && store.recommended !== store.size;
    const isWarning = isNotSame && !store.selectedSizeApproval;
    const isMobile = useMobileMediaQuery();
    const visible = getVisible({ showOn, isMobile });
    if (!visible) return null;
    return (
        <div className={cn(styles.measurements, className)}>
            <div className={styles.measurements__presentation} ref={containerRef} style={containerHeightForOldBrowsers}>
                <div className={styles.measurements__presentation__coords}>
                    <svg
                        width="100%"
                        height="100%"
                        viewBox="0 0 450 792"
                        focusable="false"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M91.925 13.126c-1.008 0-1.908-.21-2.7-.63a4.806 4.806 0 0 1-1.836-1.764c-.444-.744-.666-1.59-.666-2.538 0-.96.222-1.806.666-2.538a4.676 4.676 0 0 1 1.836-1.746c.792-.42 1.692-.63 2.7-.63.936 0 1.758.192 2.466.576.72.372 1.266.924 1.638 1.656L94.301 6.52c-.288-.456-.642-.792-1.062-1.008a2.803 2.803 0 0 0-1.332-.324c-.552 0-1.05.12-1.494.36-.444.24-.792.588-1.044 1.044-.252.444-.378.978-.378 1.602 0 .624.126 1.164.378 1.62.252.444.6.786 1.044 1.026.444.24.942.36 1.494.36.48 0 .924-.108 1.332-.324.42-.216.774-.552 1.062-1.008l1.728 1.008a3.936 3.936 0 0 1-1.638 1.674c-.708.384-1.53.576-2.466.576ZM98.01 13V3.388h2.358l3.87 6.822h-.936l4.068-6.822h2.106l.018 9.612h-2.034V5.8l.36.234-3.6 5.958h-.972l-3.618-6.12.432-.108V13H98.01Zm332.915 687.126c-1.008 0-1.908-.21-2.7-.63a4.806 4.806 0 0 1-1.836-1.764c-.444-.744-.666-1.59-.666-2.538 0-.96.222-1.806.666-2.538a4.676 4.676 0 0 1 1.836-1.746c.792-.42 1.692-.63 2.7-.63.936 0 1.758.192 2.466.576.72.372 1.266.924 1.638 1.656l-1.728 1.008c-.288-.456-.642-.792-1.062-1.008a2.803 2.803 0 0 0-1.332-.324c-.552 0-1.05.12-1.494.36-.444.24-.792.588-1.044 1.044-.252.444-.378.978-.378 1.602 0 .624.126 1.164.378 1.62.252.444.6.786 1.044 1.026.444.24.942.36 1.494.36.48 0 .924-.108 1.332-.324.42-.216.774-.552 1.062-1.008l1.728 1.008a3.936 3.936 0 0 1-1.638 1.674c-.708.384-1.53.576-2.466.576Zm6.085-.126v-9.612h2.358l3.87 6.822h-.936l4.068-6.822h2.106l.018 9.612h-2.034v-7.2l.36.234-3.6 5.958h-.972l-3.618-6.12.432-.108V700h-2.052Z"
                            fill="var(--color-gray)"
                        ></path>
                        <path
                            d="M6.492 664.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468Zm-1.28-88.966a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234H1.414l.648-6.858H9.46v1.962H2.926l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558ZM2.825 483v-11.7l1.026 1.062H.16V470.4h5.004V483h-2.34Zm10.095.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM3.124 393v-11.7l1.026 1.062H.46V380.4h5.004V393h-2.34Zm9.016.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234H8.342l.648-6.858h7.398v1.962H9.854l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558ZM.836 303v-1.566l5.004-4.752c.42-.396.732-.744.936-1.044.204-.3.336-.576.396-.828.072-.264.108-.51.108-.738 0-.576-.198-1.02-.594-1.332-.396-.324-.978-.486-1.746-.486-.612 0-1.17.108-1.674.324a3.385 3.385 0 0 0-1.278.99l-1.638-1.26c.492-.66 1.152-1.17 1.98-1.53.84-.372 1.776-.558 2.808-.558.912 0 1.704.15 2.376.45.684.288 1.206.702 1.566 1.242.372.54.558 1.182.558 1.926 0 .408-.054.816-.162 1.224-.108.396-.312.816-.612 1.26-.3.444-.738.942-1.314 1.494l-4.302 4.086-.486-.882h7.362V303H.836Zm15.895.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM.636 213v-1.566l5.004-4.752c.42-.396.732-.744.936-1.044.204-.3.336-.576.396-.828.072-.264.108-.51.108-.738 0-.576-.198-1.02-.594-1.332-.396-.324-.978-.486-1.746-.486-.612 0-1.17.108-1.674.324a3.385 3.385 0 0 0-1.278.99l-1.638-1.26c.492-.66 1.152-1.17 1.98-1.53.84-.372 1.776-.558 2.808-.558.912 0 1.704.15 2.376.45.684.288 1.206.702 1.566 1.242.372.54.558 1.182.558 1.926 0 .408-.054.816-.162 1.224-.108.396-.312.816-.612 1.26-.3.444-.738.942-1.314 1.494l-4.302 4.086-.486-.882h7.362V213H.636Zm14.814.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.398v1.962h-6.534l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558Zm-10.492-90a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l1.008-1.818c.456.372 1.008.672 1.656.9a6.083 6.083 0 0 0 2.034.342c.84 0 1.494-.168 1.962-.504.468-.348.702-.816.702-1.404 0-.576-.216-1.032-.648-1.368-.432-.336-1.128-.504-2.088-.504H3.698v-1.602l3.6-4.284.306.882H.836V110.4h8.586v1.566l-3.6 4.284-1.224-.72H5.3c1.548 0 2.706.348 3.474 1.044.78.684 1.17 1.566 1.17 2.646 0 .708-.18 1.362-.54 1.962-.36.6-.912 1.086-1.656 1.458-.732.36-1.662.54-2.79.54Zm11.773 0c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM4.846 33.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l1.008-1.818c.456.372 1.008.672 1.656.9a6.083 6.083 0 0 0 2.034.342c.84 0 1.494-.168 1.962-.504.468-.348.702-.816.702-1.404 0-.576-.216-1.032-.648-1.368-.432-.336-1.128-.504-2.088-.504H3.586v-1.602l3.6-4.284.306.882H.724V20.4H9.31v1.566l-3.6 4.284-1.224-.72h.702c1.548 0 2.706.348 3.474 1.044.78.684 1.17 1.566 1.17 2.646 0 .708-.18 1.362-.54 1.962-.36.6-.912 1.086-1.656 1.458-.732.36-1.662.54-2.79.54Zm10.517 0a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.549-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.655.9a6.24 6.24 0 0 0 2.053.342c.827 0 1.475-.174 1.943-.522.48-.348.72-.816.72-1.404 0-.396-.101-.744-.305-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.397v1.962h-6.534l1.224-1.116-.486 5.13-1.223-1.098h2.538c1.248 0 2.25.168 3.005.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.655 1.476-.732.372-1.662.558-2.79.558Z"
                            fill="currentColor"
                        ></path>
                        <path
                            d="M111 27H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m375 34v72m-9-72v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v72m0-72v72m-9-72v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v72m0-72v72m-9-72v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v72"
                            stroke="var(--color-product-primego)"
                            strokeWidth="2"
                            strokeLinecap="round"
                        ></path>
                        <path
                            d="M143.048 791.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468Zm88.92 2.034a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.398v1.962h-6.534l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558Zm85.857-.18v-11.7l1.026 1.062h-3.69V778.4h5.004V791h-2.34Zm10.095.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM407.124 791v-11.7l1.026 1.062h-3.69V778.4h5.004V791h-2.34Zm9.016.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.398v1.962h-6.534l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558Z"
                            fill="currentColor"
                        ></path>
                    </svg>
                </div>
                <div className={styles.measurements__preview}>
                    {!selectedOrOnlyRecommended || withoutSole ? null : (
                        <div
                            className={cn(styles.measurements__preview__shoeSole, {
                                [styles.fit]: selectedOrOnlyRecommended.isFit,
                            })}
                            style={
                                {
                                    '--length': selectedOrOnlyRecommended.size.length?.toString() ?? null,
                                    '--width': selectedOrOnlyRecommended.size.width?.toString() ?? null,
                                } as React.CSSProperties
                            }
                        >
                            <svg
                                preserveAspectRatio="none"
                                width="100%"
                                height="100%"
                                viewBox="0 0 244 690"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <mask
                                    id="a"
                                    style={{ maskType: 'alpha' }}
                                    maskUnits="userSpaceOnUse"
                                    x="0"
                                    y="0"
                                    width="244"
                                    height="690"
                                >
                                    {sku === 'EM24' ? (
                                        <path
                                            d="M219.626 37.13c25.106 38.01 25.433 95.704 23.822 139.002-1.215 32.637-6.028 53.356-17.395 83.25-3.486 9.17-7.602 17.682-11.477 26.652-15.064 34.864-27.75 69.607-28.242 108.101-.213 16.581 2.068 31.596 4.85 47.847 2.659 15.525 4.885 30.801 8.035 46.283 3.121 15.34 6.142 30.226 9.751 45.48 7.408 31.319 13.947 64.497 8.396 96.501-2.876 16.58-12.234 35.223-25.377 46.092-12.955 10.712-27.381 13.428-43.772 13.653-60.339.824-76.834-53.248-81.692-103.039-3.732-31.958-6.849-62.987-10.834-95.07-3.399-27.358-12.618-63.845-19.69-90.874C19.639 338.46-2.541 283.374.239 217.274c1.58-37.578 11.78-76.943 27.712-110.999C41.62 77.051 62.8 43.172 88.633 23.118c10.11-7.848 27.963-17.65 40.364-20.757 33.42-8.375 71.675 6.073 90.629 34.769Z"
                                            fill="currentColor"
                                        />
                                    ) : (
                                        <path
                                            d="M170.934 5.963c17.267 7.33 28.635 19.367 36.908 34.338 19.171 34.693 32.556 91.817 35.623 131.39 1.907 33.502-1.217 67.986-10.504 100.564-17.651 61.921-36.231 90.341-35.065 157.068.281 16.114 2.426 30.782 4.266 46.693 3.46 29.921 10.198 60.817 16.115 90.489 6.421 32.206 10.88 68.921-12.457 96.936-21.653 25.994-65.21 33.675-97.42 19.629-34.593-15.599-46.418-45.098-51.388-77.175-5.651-45.207-6.318-93.5-12.867-140.02-5.984-42.492-22.141-91.209-32.676-132.501C5.415 309.643-.023 265.429 0 241.136.063 175.477 30.585 86.349 75.891 34.747c10.577-12.046 23.43-24.814 39.872-30.47 17.96-6.178 37.767-5.703 55.171 1.686Z"
                                            fill="currentColor"
                                        />
                                    )}
                                </mask>
                                <g mask="url(#a)" fill="currentColor" fillOpacity=".4">
                                    <rect height="690" width="244"></rect>
                                    <path
                                        opacity=".15"
                                        d="M232.489 436.304c0-4.977 1.463-9.199 4.387-12.667 2.925-3.468 7.718-5.277 14.38-5.428h33.877v18.095h-33.877v41.617l27.784-9.952 6.093 15.833-33.877 12.214v46.594h33.877v16.964h-52.644v-123.27ZM141.568 436.304c0-4.977 1.463-9.199 4.387-12.667 2.925-3.468 7.718-5.277 14.38-5.428h21.204l3.899 5.202 3.656-5.202h20.229c6.662.151 11.455 1.96 14.38 5.428 2.925 3.468 4.387 7.69 4.387 12.667v123.27h-18.767v-123.27h-15.11v123.27h-18.767v-123.27h-15.111v123.27h-18.767v-123.27ZM118.482 559.574V418.209h18.767v141.365h-18.767ZM61.36 418.209h33.877c6.662.151 11.455 1.96 14.38 5.428 2.924 3.468 4.387 7.69 4.387 12.667v24.88c0 4.976-.325 9.952-.975 14.928-.488 4.825-2.763 8.369-6.825 10.631l-7.311 2.714 15.111 70.117H95.237l-15.111-68.986v68.986H61.359V418.209Zm18.766 18.095v41.617l15.11-5.428v-36.189h-15.11ZM23.004 436.304v41.617l15.11-5.428v-36.189h-15.11Zm15.11-18.095c6.663.151 11.456 1.96 14.38 5.428 2.925 3.468 4.388 7.69 4.388 12.667v24.88c0 4.976-.325 9.952-.975 14.928-.488 4.825-2.763 8.369-6.825 10.631l-26.078 9.273v63.558H4.237V418.209h33.878ZM204.498 587.435c0-4.976 1.462-9.199 4.387-12.667s7.718-5.277 14.38-5.428h15.111c6.661.151 11.455 1.96 14.379 5.428 2.925 3.468 4.387 7.691 4.387 12.667v106.306c0 6.635-.568 11.159-1.706 13.572-1.137 2.261-3.087 3.392-5.849 3.392h-37.534c-2.762 0-4.711-1.131-5.849-3.392-1.137-2.413-1.706-6.937-1.706-13.572V587.435Zm18.767 106.306h15.111V587.435h-15.111v106.306ZM181.252 569.34c6.661.151 11.455 1.96 14.379 5.428 2.925 3.468 4.387 7.691 4.387 12.667v17.19h-18.766v-17.19h-15.111v106.306h15.111v-51.343l-7.8 2.261v-18.773l26.566-7.69v75.545c0 6.635-.568 11.159-1.706 13.572-1.137 2.261-3.087 3.392-5.849 3.392h-45.089V569.34h33.878ZM90.252 587.435c0-4.976 1.462-9.199 4.387-12.667s7.718-5.277 14.38-5.428h33.877v18.095h-33.877v41.618l27.784-9.953 6.093 15.833-33.877 12.214v46.594h33.877v16.964H90.252v-123.27ZM-.669 587.435c0-4.976 1.462-9.199 4.387-12.667s7.718-5.277 14.38-5.428h21.204l3.9 5.202 3.655-5.202h20.229c6.662.151 11.455 1.96 14.38 5.428 2.924 3.468 4.387 7.691 4.387 12.667v123.27H67.086v-123.27h-15.11v123.27H33.208v-123.27H18.098v123.27H-.67v-123.27ZM263.261 266.669c6.662.151 11.455 1.96 14.38 5.428 2.925 3.469 4.387 7.691 4.387 12.667v17.19h-18.767v-17.19H248.15v106.307h15.111v-51.344l-7.799 2.261v-18.773l26.566-7.69v75.546c0 6.634-.569 11.158-1.706 13.571-1.137 2.261-3.087 3.392-5.849 3.392h-45.089V266.669h33.877ZM172.262 284.764c0-4.976 1.462-9.198 4.387-12.667 2.924-3.468 7.718-5.277 14.379-5.428h33.878v18.095h-33.878v41.618l27.785-9.952 6.093 15.833-33.878 12.213v46.595h33.878v16.963h-52.644v-123.27ZM81.34 284.764c0-4.976 1.463-9.198 4.388-12.667 2.925-3.468 7.718-5.277 14.379-5.428h21.204l3.9 5.202 3.656-5.202h20.229c6.662.151 11.455 1.96 14.379 5.428 2.925 3.469 4.387 7.691 4.387 12.667v123.27h-18.766v-123.27h-15.111v123.27h-18.767v-123.27h-15.111v123.27H81.341v-123.27ZM58.256 408.034V266.669h18.766v141.365H58.256ZM1.132 266.669h33.877c6.662.151 11.455 1.96 14.38 5.428 2.925 3.469 4.387 7.691 4.387 12.667v24.88c0 4.976-.325 9.952-.975 14.928-.487 4.826-2.762 8.369-6.824 10.631l-7.312 2.714 15.111 70.117H35.009L19.9 339.048v68.986H1.131V266.669Zm18.766 18.095v41.618l15.111-5.429v-36.189H19.9ZM241.459 133.159c0-4.976 1.462-9.198 4.387-12.666 2.925-3.469 7.718-5.278 14.38-5.429h33.877v18.095h-33.877v41.618l27.784-9.952 6.093 15.833-33.877 12.214v46.594h33.877v16.964h-52.644V133.159ZM150.538 133.159c0-4.976 1.462-9.198 4.387-12.666 2.925-3.469 7.718-5.278 14.38-5.429h21.204l3.899 5.202 3.656-5.202h20.229c6.662.151 11.455 1.96 14.38 5.429 2.924 3.468 4.387 7.69 4.387 12.666V256.43h-18.767V133.159h-15.111V256.43h-18.766V133.159h-15.111V256.43h-18.767V133.159ZM127.452 256.43V115.064h18.767V256.43h-18.767ZM70.33 115.064h33.877c6.661.151 11.455 1.96 14.379 5.429 2.925 3.468 4.387 7.69 4.387 12.666v24.88c0 4.976-.325 9.952-.975 14.928-.487 4.826-2.762 8.369-6.824 10.631l-7.312 2.714 15.111 70.118h-18.766l-15.111-68.987v68.987H70.329V115.064Zm18.766 18.095v41.618l15.111-5.428v-36.19H89.096ZM31.974 133.159v41.618l15.11-5.428v-36.19h-15.11Zm15.11-18.095c6.662.151 11.455 1.96 14.38 5.429 2.925 3.468 4.387 7.69 4.387 12.666v24.88c0 4.976-.325 9.952-.975 14.928-.487 4.826-2.762 8.369-6.824 10.631l-26.078 9.274v63.558H13.207V115.064h33.877ZM211.103-19.059c0-4.976 1.462-9.198 4.387-12.666 2.924-3.468 7.717-5.278 14.379-5.429h33.878v18.095h-33.878v41.618l27.785-9.952 6.093 15.833-33.878 12.214v46.594h33.878v16.964h-52.644V-19.059ZM120.182-19.059c0-4.976 1.462-9.198 4.387-12.666 2.924-3.468 7.718-5.278 14.379-5.429h21.204l3.9 5.202 3.656-5.202h20.229c6.661.151 11.455 1.96 14.379 5.429 2.925 3.468 4.387 7.69 4.387 12.666v123.271h-18.766V-19.059h-15.111v123.271h-18.767V-19.059h-15.111v123.271h-18.766V-19.059ZM97.096 104.212V-37.154h18.766v141.366H97.096ZM39.973-37.154H73.85c6.662.151 11.455 1.96 14.38 5.429 2.924 3.468 4.387 7.69 4.387 12.666v24.88c0 4.976-.325 9.952-.975 14.929-.487 4.825-2.762 8.368-6.824 10.63l-7.312 2.714 15.11 70.118H73.85L58.74 35.225v68.987H39.972V-37.154Zm18.766 18.095v41.618L73.85 17.13v-36.19H58.74ZM1.617-19.059v41.618l15.111-5.428v-36.19H1.618Zm15.111-18.095c6.662.151 11.455 1.96 14.38 5.429 2.924 3.468 4.387 7.69 4.387 12.666v24.88c0 4.976-.325 9.952-.975 14.929-.488 4.825-2.762 8.368-6.824 10.63L1.617 40.654v63.558h-18.766V-37.154h33.877Z"
                                    />
                                </g>
                            </svg>
                        </div>
                    )}
                    <div
                        className={styles.measurements__preview__foot}
                        style={
                            {
                                '--length': store.length?.toString() ?? null,
                                '--width': store.width?.toString() ?? null,
                            } as React.CSSProperties
                        }
                    >
                        {!store.length ? null : (
                            <div className={cn(styles.measurement__tooltip, styles.yTooltip)}>
                                <span>{toCm(store.length)?.toFixed(1)}</span>
                                <svg
                                    className={styles.measurement__tooltip__arrow}
                                    focusable="false"
                                    aria-hidden="true"
                                    width="12"
                                    height="6"
                                    viewBox="0 0 12 16"
                                >
                                    <path stroke="none" d="M0,0 H12 L6,6 Q6,6 6,6 Z"></path>
                                </svg>
                            </div>
                        )}
                        {!store.width ? null : (
                            <div className={cn(styles.measurement__tooltip, styles.xTooltip)}>
                                <span>{toCm(store.width)?.toFixed(1)}</span>
                                <svg
                                    className={styles.measurement__tooltip__arrow}
                                    focusable="false"
                                    aria-hidden="true"
                                    width="12"
                                    height="6"
                                    viewBox="0 0 12 16"
                                >
                                    <path stroke="none" d="M0,0 H12 L6,6 Q6,6 6,6 Z"></path>
                                </svg>
                            </div>
                        )}
                        <svg
                            preserveAspectRatio="none"
                            width="100%"
                            height="100%"
                            focusable="false"
                            viewBox="0 0 197 590"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M131.595 113.106c-2.767-5.202-5.533-10.403-8.082-15.418-.548.279-1.123.349-1.481.605l1.725 14.269c11.522 6.912 22.146 19.256 38.492 13.025l.329 2.728c-2.605.953-5.491 2.792-7.866 2.44-6.981-1.5-14.347-2.953-20.574-6.246-10.387-5.56-20.864-10.256-32.174-10.594-4.481-.098-9.818.759-12.987 3.484-13.197 11.387-25.934 23.356-38.021 35.886-8.306 8.455-15.042 18.636-22.888 27.674-1.712 1.91-6.04 3.071-7.917 2.019-3.776-2.312-1.693-5.97.493-8.788 5.891-7.525 12-14.862 17.483-22.55 1.163-1.63 1.931-4.917 1.32-6.759-2.344-6.53-5.07-13.014-8.487-18.776-1.912-2.963-5.548-5.718-8.93-6.374-4.8-1.123-8.3 2.067-10.207 7.193-4.799 13.354-3.29 27.437-2.192 41.356.29 4.011.989 8.184 1.496 12.381-.549.279-1.315.372-1.864.651-1.248-3.895-2.662-7.556-3.527-11.497-3.053-12.406-4.166-24.833-1.782-37.257 2.205-10.699 6.004-19.46 18.438-19.471.103-16.832.666-33.08 21.502-34.318.359-17.927 3.92-33.473 23.43-36.042C68.7 30 71.55 26.25 81.738 23.742c16.408-4.11 17.033-3.76 23.013 5.525 2.023-5.78 3.191-13.798 7.255-18.76 4.421-5.217 11.509-9.266 18.021-10.053 14.121-2.13 26.615 3.175 35.093 17.056 5.813 9.517 10.937 19.757 16.559 29.298 8.797 14.907 7.06 31.266 6.906 47.678-.305 32.438 19.083 79.704 0 125.624-17.712 42.622-39.32 85.071-36.019 131.224 4.585 62.438 62.452 199.452-3.199 231.252-35.006 16.956-60.7 2.919-74.857-22.805-15.82-28.743-18.395-71.019-27.625-124.822C29.66 334.545 11.246 282.135.038 234.926c-.47-2.285 3.555-.886 4.404 2.001 12.81 43.608 36.027 116.021 48.448 188.43 9.266 54.014 12.826 99.804 28.426 128.823 12.64 23.514 35.515 37.835 65.506 21.204 62.048-34.406.704-164.722-3.462-224.05-2.827-39.472 14.38-77.292 35.887-124.685 28.022-61.749-.8-101.062 3.111-150.116.149-10.025-2.474-18.863-7.178-27.238-5.188-9.167-10.21-18.567-15.565-27.501C149.532 4.275 128.33.873 115.961 14.288c-1.713 1.91-3.489 4.892-3.734 7.69-.571 11.353-.568 22.636-.73 34.153-.267 13.872 4.485 25.86 11.867 37.104 2.856 4.34 5.188 9.167 7.329 14.019.969 1.585.673 3.963.902 5.852Zm-43.196-6.921c9.804.732 19.608 1.465 29.387 1.988.791-14.36.407-14.314-5.57-26.793-2.842-5.83-5.428-12.758-5.423-19.145-.029-11.494-4.31-21.196-9-31.063-.777-1.61-3.354-3.64-4.861-3.245-4.979.6-10.1 1.644-14.71 3.69-5.351 2.35-6.237 9.483-2.706 14.592C86.521 61.7 93.414 78.54 88.661 98.701c-.487 2.401-.158 5.129-.262 7.484-.47-2.286-1.375-4.945-1.679-7.463-.468-5.478.572-11.352-1.02-16.483-2.673-9.258-7.045-18.1-10.46-27.054-2.266-5.9-6.057-6.72-10.96-5.49-8.11 2.043-12.263 7.866-13.904 16.793-1.526 8.275-2.337 16.038 6.774 20.687 2.068 1.028 3.687 3.174 5.614 4.645 4.988 4.295 6.388 9.448 4.275 16.09-1.548 4.871-2.28 10.07-3.42 15.103.433.374.867.748 1.468.888 7.817-6.053 15.66-11.896 23.312-17.716Zm-46.208 40.494c4.139-4.332 7.296-8.758 11.447-11.389 6.489-4.19 7.528-10.063 8.964-17.475 2.642-13.52-.747-22.265-12.053-28.991-6.903-4.064-13.783-4.724-18.346.937-4.396 5.427-5.75 21.559-2.652 26.294 3.341 5.133 6.183 10.964 8.616 16.632 1.848 4.034 2.598 8.628 4.024 13.992Z"
                                fill="currentColor"
                            ></path>
                        </svg>
                    </div>
                </div>
            </div>
            {withoutSole ? null : (
                <>
                    <div className={styles.recommendedSize}>
                        {t("fitting.Ваш рекомендованный размер")}: <span>{store.recommended ?? '-'}</span>
                    </div>
                    {isWarning ? <div className={styles.warning}>{warning}</div> : null}
                </>
            )}
        </div>
    );
}

const useMobileMediaQuery = () => {
    const mediaQuery = window.matchMedia('screen and (max-width: 1023px)');
    const [match, setMatch] = useState(mediaQuery.matches);

    useEffect(() => {
        const onChange = () => setMatch(mediaQuery.matches);
        mediaQuery.addEventListener('change', onChange);
        return () => mediaQuery.removeEventListener('change', onChange);
    }, [mediaQuery]);

    return match;
};

const getVisible = ({ showOn, isMobile }: Pick<Props, 'showOn'> & { isMobile: boolean }) => {
    switch (showOn) {
        case 'mobile':
            return isMobile;
        case 'desktop':
            return !isMobile;
        default:
            return true;
    }
};

function toCm(valueInMm: number | undefined) {
    if (!valueInMm) return undefined;
    return valueInMm / 10;
}

export default MeasurementsIllustration;
