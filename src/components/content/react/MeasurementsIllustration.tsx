import React, { useEffect, useRef, useState } from 'react';
import { useStore } from '@nanostores/react';
import { $selectedOrOnlyRecommendedSize, $selectedProduct } from '../../../stores/fittingProductStore.ts';
import styles from './MeasurementsIllustration.module.scss';
import cn from 'classnames';
import { useTranslations } from '../../../i18n/utils';

const lang = document.documentElement.lang;
const t = useTranslations(lang);

interface Props {
    showOn?: 'mobile' | 'desktop';
    withoutSole?: boolean;
    className?: string;
    warning?: any;
}
function MeasurementsIllustration({ showOn, withoutSole, className, warning }: Props) {
    const store = useStore($selectedProduct);
    const selectedOrOnlyRecommended = useStore($selectedOrOnlyRecommendedSize);
    const containerRef = useRef<HTMLDivElement>(null);
    const containerHeightForOldBrowsers = {
        '--height': `${containerRef.current?.offsetHeight}px`,
    } as React.CSSProperties;
    const isNotSame = store.recommended && store.size && store.recommended !== store.size;
    const isWarning = isNotSame && !store.selectedSizeApproval;
    const isMobile = useMobileMediaQuery();
    const visible = getVisible({ showOn, isMobile });
    if (!visible) return null;
    return (
        <div className={cn(styles.measurements, className)}>
            <div className={styles.measurements__presentation} ref={containerRef} style={containerHeightForOldBrowsers}>
                <div className={styles.measurements__presentation__coords}>
                    <svg
                        width="100%"
                        height="100%"
                        viewBox="0 0 450 792"
                        focusable="false"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M91.925 13.126c-1.008 0-1.908-.21-2.7-.63a4.806 4.806 0 0 1-1.836-1.764c-.444-.744-.666-1.59-.666-2.538 0-.96.222-1.806.666-2.538a4.676 4.676 0 0 1 1.836-1.746c.792-.42 1.692-.63 2.7-.63.936 0 1.758.192 2.466.576.72.372 1.266.924 1.638 1.656L94.301 6.52c-.288-.456-.642-.792-1.062-1.008a2.803 2.803 0 0 0-1.332-.324c-.552 0-1.05.12-1.494.36-.444.24-.792.588-1.044 1.044-.252.444-.378.978-.378 1.602 0 .624.126 1.164.378 1.62.252.444.6.786 1.044 1.026.444.24.942.36 1.494.36.48 0 .924-.108 1.332-.324.42-.216.774-.552 1.062-1.008l1.728 1.008a3.936 3.936 0 0 1-1.638 1.674c-.708.384-1.53.576-2.466.576ZM98.01 13V3.388h2.358l3.87 6.822h-.936l4.068-6.822h2.106l.018 9.612h-2.034V5.8l.36.234-3.6 5.958h-.972l-3.618-6.12.432-.108V13H98.01Zm332.915 687.126c-1.008 0-1.908-.21-2.7-.63a4.806 4.806 0 0 1-1.836-1.764c-.444-.744-.666-1.59-.666-2.538 0-.96.222-1.806.666-2.538a4.676 4.676 0 0 1 1.836-1.746c.792-.42 1.692-.63 2.7-.63.936 0 1.758.192 2.466.576.72.372 1.266.924 1.638 1.656l-1.728 1.008c-.288-.456-.642-.792-1.062-1.008a2.803 2.803 0 0 0-1.332-.324c-.552 0-1.05.12-1.494.36-.444.24-.792.588-1.044 1.044-.252.444-.378.978-.378 1.602 0 .624.126 1.164.378 1.62.252.444.6.786 1.044 1.026.444.24.942.36 1.494.36.48 0 .924-.108 1.332-.324.42-.216.774-.552 1.062-1.008l1.728 1.008a3.936 3.936 0 0 1-1.638 1.674c-.708.384-1.53.576-2.466.576Zm6.085-.126v-9.612h2.358l3.87 6.822h-.936l4.068-6.822h2.106l.018 9.612h-2.034v-7.2l.36.234-3.6 5.958h-.972l-3.618-6.12.432-.108V700h-2.052Z"
                            fill="var(--color-gray)"
                        ></path>
                        <path
                            d="M6.492 664.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468Zm-1.28-88.966a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234H1.414l.648-6.858H9.46v1.962H2.926l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558ZM2.825 483v-11.7l1.026 1.062H.16V470.4h5.004V483h-2.34Zm10.095.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM3.124 393v-11.7l1.026 1.062H.46V380.4h5.004V393h-2.34Zm9.016.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234H8.342l.648-6.858h7.398v1.962H9.854l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558ZM.836 303v-1.566l5.004-4.752c.42-.396.732-.744.936-1.044.204-.3.336-.576.396-.828.072-.264.108-.51.108-.738 0-.576-.198-1.02-.594-1.332-.396-.324-.978-.486-1.746-.486-.612 0-1.17.108-1.674.324a3.385 3.385 0 0 0-1.278.99l-1.638-1.26c.492-.66 1.152-1.17 1.98-1.53.84-.372 1.776-.558 2.808-.558.912 0 1.704.15 2.376.45.684.288 1.206.702 1.566 1.242.372.54.558 1.182.558 1.926 0 .408-.054.816-.162 1.224-.108.396-.312.816-.612 1.26-.3.444-.738.942-1.314 1.494l-4.302 4.086-.486-.882h7.362V303H.836Zm15.895.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM.636 213v-1.566l5.004-4.752c.42-.396.732-.744.936-1.044.204-.3.336-.576.396-.828.072-.264.108-.51.108-.738 0-.576-.198-1.02-.594-1.332-.396-.324-.978-.486-1.746-.486-.612 0-1.17.108-1.674.324a3.385 3.385 0 0 0-1.278.99l-1.638-1.26c.492-.66 1.152-1.17 1.98-1.53.84-.372 1.776-.558 2.808-.558.912 0 1.704.15 2.376.45.684.288 1.206.702 1.566 1.242.372.54.558 1.182.558 1.926 0 .408-.054.816-.162 1.224-.108.396-.312.816-.612 1.26-.3.444-.738.942-1.314 1.494l-4.302 4.086-.486-.882h7.362V213H.636Zm14.814.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.398v1.962h-6.534l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558Zm-10.492-90a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l1.008-1.818c.456.372 1.008.672 1.656.9a6.083 6.083 0 0 0 2.034.342c.84 0 1.494-.168 1.962-.504.468-.348.702-.816.702-1.404 0-.576-.216-1.032-.648-1.368-.432-.336-1.128-.504-2.088-.504H3.698v-1.602l3.6-4.284.306.882H.836V110.4h8.586v1.566l-3.6 4.284-1.224-.72H5.3c1.548 0 2.706.348 3.474 1.044.78.684 1.17 1.566 1.17 2.646 0 .708-.18 1.362-.54 1.962-.36.6-.912 1.086-1.656 1.458-.732.36-1.662.54-2.79.54Zm11.773 0c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM4.846 33.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l1.008-1.818c.456.372 1.008.672 1.656.9a6.083 6.083 0 0 0 2.034.342c.84 0 1.494-.168 1.962-.504.468-.348.702-.816.702-1.404 0-.576-.216-1.032-.648-1.368-.432-.336-1.128-.504-2.088-.504H3.586v-1.602l3.6-4.284.306.882H.724V20.4H9.31v1.566l-3.6 4.284-1.224-.72h.702c1.548 0 2.706.348 3.474 1.044.78.684 1.17 1.566 1.17 2.646 0 .708-.18 1.362-.54 1.962-.36.6-.912 1.086-1.656 1.458-.732.36-1.662.54-2.79.54Zm10.517 0a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.549-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.655.9a6.24 6.24 0 0 0 2.053.342c.827 0 1.475-.174 1.943-.522.48-.348.72-.816.72-1.404 0-.396-.101-.744-.305-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.397v1.962h-6.534l1.224-1.116-.486 5.13-1.223-1.098h2.538c1.248 0 2.25.168 3.005.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.655 1.476-.732.372-1.662.558-2.79.558Z"
                            fill="currentColor"
                        ></path>
                        <path
                            d="M111 27H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m72 0H39m72 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H75m36 9H93m18 9H39m375 34v72m-9-72v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v72m0-72v72m-9-72v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v72m0-72v72m-9-72v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v36m-9-36v18m-9-18v72"
                            stroke="var(--color-product-primego)"
                            strokeWidth="2"
                            strokeLinecap="round"
                        ></path>
                        <path
                            d="M143.048 791.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468Zm88.92 2.034a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.398v1.962h-6.534l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558Zm85.857-.18v-11.7l1.026 1.062h-3.69V778.4h5.004V791h-2.34Zm10.095.18c-.996 0-1.896-.252-2.7-.756-.792-.504-1.416-1.236-1.872-2.196-.456-.972-.684-2.148-.684-3.528s.228-2.55.684-3.51c.456-.972 1.08-1.71 1.872-2.214.804-.504 1.704-.756 2.7-.756 1.008 0 1.908.252 2.7.756.792.504 1.416 1.242 1.872 2.214.468.96.702 2.13.702 3.51s-.234 2.556-.702 3.528c-.456.96-1.08 1.692-1.872 2.196-.792.504-1.692.756-2.7.756Zm0-2.034c.588 0 1.098-.156 1.53-.468.432-.324.768-.816 1.008-1.476.252-.66.378-1.494.378-2.502 0-1.02-.126-1.854-.378-2.502-.24-.66-.576-1.146-1.008-1.458-.432-.324-.942-.486-1.53-.486a2.5 2.5 0 0 0-1.512.486c-.432.312-.774.798-1.026 1.458-.24.648-.36 1.482-.36 2.502 0 1.008.12 1.842.36 2.502.252.66.594 1.152 1.026 1.476.444.312.948.468 1.512.468ZM407.124 791v-11.7l1.026 1.062h-3.69V778.4h5.004V791h-2.34Zm9.016.18a9.155 9.155 0 0 1-2.61-.378c-.84-.264-1.548-.624-2.124-1.08l.99-1.818c.456.372 1.008.672 1.656.9a6.24 6.24 0 0 0 2.052.342c.828 0 1.476-.174 1.944-.522.48-.348.72-.816.72-1.404 0-.396-.102-.744-.306-1.044-.192-.3-.54-.528-1.044-.684-.492-.156-1.17-.234-2.034-.234h-3.042l.648-6.858h7.398v1.962h-6.534l1.224-1.116-.486 5.13-1.224-1.098h2.538c1.248 0 2.25.168 3.006.504.768.324 1.326.78 1.674 1.368.36.576.54 1.236.54 1.98 0 .732-.18 1.404-.54 2.016-.36.612-.912 1.104-1.656 1.476-.732.372-1.662.558-2.79.558Z"
                            fill="currentColor"
                        ></path>
                    </svg>
                </div>
                <div className={styles.measurements__preview}>
                    {!selectedOrOnlyRecommended || withoutSole ? null : (
                        <div
                            className={cn(styles.measurements__preview__shoeSole, {
                                [styles.fit]: selectedOrOnlyRecommended.isFit,
                            })}
                            style={
                                {
                                    '--length': selectedOrOnlyRecommended.size.length?.toString() ?? null,
                                    '--width': selectedOrOnlyRecommended.size.width?.toString() ?? null,
                                } as React.CSSProperties
                            }
                        >
                            <svg
                                preserveAspectRatio="none"
                                width="100%"
                                height="100%"
                                viewBox="0 0 244 576"
                                focusable="false"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <mask
                                    id="a"
                                    style={{ maskType: 'alpha' }}
                                    maskUnits="userSpaceOnUse"
                                    x="4"
                                    y="1"
                                    width="231"
                                    height="573"
                                >
                                    <path
                                        d="M229.115 175.781c17.897-100-11.014-206.9-117.671-164.79C-31.449 67.41 1.615 259.78 27.615 484.778c9.183 79.46 75.5 111.76 119.5 70.505 32-30.004 42-70.505 46.5-209 1.235-37.981 19.866-83.141 35.5-170.501Z"
                                        fill="currentColor"
                                    ></path>
                                </mask>
                                <g mask="url(#a)" fill="currentColor" fillOpacity=".4">
                                    <rect height="576" width="244"></rect>
                                    <path
                                        opacity=".15"
                                        d="M191.125 360.576c0-4.384 1.142-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.222-4.783h26.437v15.943h-26.437v36.67l21.682-8.769 4.755 13.95-26.437 10.762v41.053h26.437v14.947h-41.083V360.576ZM120.172 360.576c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h16.548l3.043 4.584 2.853-4.584h15.786c5.199.133 8.94 1.727 11.222 4.783s3.424 6.776 3.424 11.16v108.613h-14.646V360.576h-11.792v108.613H146.61V360.576h-11.793v108.613h-14.645V360.576ZM102.156 469.189V344.633h14.645v124.556h-14.645ZM57.578 344.633h26.437c5.199.133 8.94 1.727 11.222 4.783s3.424 6.776 3.424 11.16v21.922c0 4.385-.254 8.769-.761 13.153-.38 4.252-2.156 7.374-5.326 9.367l-5.706 2.391 11.793 61.78H84.014l-11.792-60.783v60.783H57.578V344.633Zm14.645 15.943v36.67l11.792-4.783v-31.887H72.223ZM27.645 360.576v36.67l11.793-4.783v-31.887H27.645Zm11.793-15.943c5.198.133 8.939 1.727 11.221 4.783 2.283 3.056 3.424 6.776 3.424 11.16v21.922c0 4.385-.254 8.769-.76 13.153-.381 4.252-2.156 7.374-5.326 9.367l-20.352 8.171v56H13V344.633h26.438ZM169.281 493.736c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h11.793c5.199.133 8.939 1.727 11.221 4.783 2.283 3.056 3.424 6.776 3.424 11.16v93.666c0 5.846-.444 9.832-1.331 11.957-.888 1.993-2.41 2.99-4.565 2.99h-29.291c-2.155 0-3.677-.997-4.564-2.99-.888-2.125-1.332-6.111-1.332-11.957v-93.666Zm14.645 93.666h11.793v-93.666h-11.793v93.666ZM151.14 477.793c5.199.133 8.94 1.727 11.222 4.783 2.283 3.056 3.424 6.776 3.424 11.16v15.146H151.14v-15.146h-11.792v93.666h11.792v-45.239l-6.086 1.993v-16.541l20.732-6.775v66.562c0 5.846-.444 9.832-1.332 11.957-.887 1.993-2.409 2.99-4.564 2.99h-35.187V477.793h26.437ZM80.126 493.736c0-4.384 1.14-8.104 3.423-11.16 2.282-3.056 6.023-4.65 11.222-4.783h26.437v15.943H94.771v36.669l21.682-8.768 4.755 13.95-26.437 10.762v41.053h26.437v14.947H80.126V493.736ZM9.172 493.736c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h16.548l3.043 4.584 2.853-4.584h15.786c5.2.133 8.94 1.727 11.222 4.783s3.424 6.776 3.424 11.16v108.613H62.047V493.736H50.255v108.613H35.61V493.736H23.817v108.613H9.172V493.736ZM-8.844 602.349V477.793H5.8v124.556H-8.844ZM233.281 227.056c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h11.793c5.199.133 8.939 1.727 11.221 4.783 2.283 3.056 3.424 6.776 3.424 11.16v93.666c0 5.846-.444 9.832-1.331 11.957-.888 1.993-2.41 2.99-4.565 2.99h-29.291c-2.155 0-3.677-.997-4.564-2.99-.888-2.125-1.332-6.111-1.332-11.957v-93.666Zm14.645 93.666h11.793v-93.666h-11.793v93.666ZM215.14 211.113c5.199.133 8.94 1.727 11.222 4.783 2.283 3.056 3.424 6.776 3.424 11.16v15.146H215.14v-15.146h-11.792v93.666h11.792v-45.239l-6.086 1.993v-16.541l20.732-6.775v66.562c0 5.846-.444 9.832-1.332 11.957-.887 1.993-2.409 2.99-4.564 2.99h-35.187V211.113h26.437ZM144.125 227.056c0-4.384 1.142-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.222-4.783h26.437v15.943h-26.437v36.669l21.682-8.768 4.755 13.95-26.437 10.762v41.053h26.437v14.947h-41.083V227.056ZM73.172 227.056c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h16.548l3.043 4.584 2.853-4.584h15.786c5.199.133 8.94 1.727 11.222 4.783s3.424 6.776 3.424 11.16v108.613h-14.646V227.056h-11.792v108.613H99.61V227.056H87.817v108.613H73.172V227.056ZM55.156 335.669V211.113H69.8v124.556H55.156ZM10.578 211.113h26.437c5.199.133 8.94 1.727 11.222 4.783s3.423 6.776 3.423 11.16v21.922c0 4.384-.253 8.769-.76 13.153-.38 4.252-2.156 7.374-5.326 9.367l-5.706 2.391 11.792 61.78H37.016l-11.792-60.783v60.783H10.578V211.113Zm14.645 15.943v36.669l11.792-4.782v-31.887H25.223ZM-19.355 227.056v36.669l11.793-4.782v-31.887h-11.793Zm11.793-15.943c5.198.133 8.94 1.727 11.221 4.783 2.283 3.056 3.424 6.776 3.424 11.16v21.922c0 4.384-.254 8.769-.76 13.153-.381 4.252-2.156 7.374-5.326 9.367l-20.352 8.171v56H-34V211.113h26.438ZM198.125 93.479c0-4.384 1.142-8.105 3.424-11.16 2.282-3.056 6.023-4.65 11.222-4.783h26.437v15.943h-26.437v36.669l21.682-8.769 4.755 13.951-26.437 10.761v41.054h26.437v14.946h-41.083V93.479ZM127.172 93.479c0-4.384 1.141-8.105 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h16.548l3.043 4.584 2.853-4.584h15.786c5.199.133 8.94 1.727 11.222 4.783 2.282 3.055 3.424 6.776 3.424 11.16V202.09h-14.646V93.479h-11.792V202.09H153.61V93.479h-11.793V202.09h-14.645V93.479ZM109.156 202.091V77.536h14.645V202.09h-14.645ZM64.578 77.536h26.437c5.199.133 8.94 1.727 11.222 4.783 2.282 3.055 3.424 6.776 3.424 11.16V115.4c0 4.384-.254 8.768-.761 13.153-.381 4.251-2.156 7.373-5.326 9.366l-5.706 2.392 11.793 61.779H91.015l-11.792-60.783v60.783H64.578V77.536Zm14.645 15.943v36.669l11.792-4.783V93.479H79.223ZM34.645 93.479v36.669l11.793-4.783V93.479H34.645Zm11.793-15.943c5.198.133 8.939 1.727 11.221 4.783 2.283 3.055 3.424 6.776 3.424 11.16V115.4c0 4.384-.254 8.768-.76 13.153-.381 4.251-2.156 7.373-5.326 9.366l-20.352 8.171v56H20V77.536h26.438ZM245.451-56.582c5.199.133 8.939 1.727 11.222 4.783 2.282 3.056 3.423 6.776 3.423 11.16v15.146h-14.645v-15.146h-11.792v93.666h11.792V7.788l-6.086 1.993v-16.54l20.731-6.776v66.562c0 5.846-.443 9.832-1.331 11.957-.888 1.993-2.409 2.99-4.565 2.99h-35.187V-56.582h26.438ZM174.436-40.639c0-4.384 1.141-8.104 3.424-11.16 2.282-3.056 6.023-4.65 11.221-4.783h26.438v15.943h-26.438v36.67l21.683-8.77 4.755 13.951-26.438 10.762v41.053h26.438v14.947h-41.083V-40.64ZM103.483-40.639c0-4.384 1.141-8.104 3.423-11.16 2.283-3.056 6.023-4.65 11.222-4.783h16.547l3.043 4.584 2.853-4.584h15.787c5.199.133 8.939 1.727 11.222 4.783 2.282 3.056 3.423 6.776 3.423 11.16V67.974h-14.645V-40.64h-11.792V67.974H129.92V-40.64h-11.792V67.974h-14.645V-40.64ZM85.466 67.974V-56.582h14.646V67.974H85.466ZM40.888-56.582h26.438c5.199.133 8.94 1.727 11.222 4.783s3.423 6.776 3.423 11.16v21.922c0 4.384-.254 8.769-.76 13.153-.381 4.252-2.156 7.374-5.326 9.367l-5.706 2.391 11.792 61.78H67.326L55.534 7.19v60.783H40.887V-56.582Zm14.645 15.943v36.67l11.793-4.783V-40.64H55.534ZM10.956-40.639v36.67l11.792-4.783V-40.64H10.956Zm11.792-15.943c5.199.133 8.94 1.727 11.222 4.783s3.424 6.776 3.424 11.16v21.922c0 4.384-.254 8.769-.761 13.153-.38 4.252-2.156 7.374-5.326 9.367l-20.351 8.17v56H-3.689V-56.581h26.437Z"
                                    ></path>
                                </g>
                            </svg>
                        </div>
                    )}
                    <div
                        className={styles.measurements__preview__foot}
                        style={
                            {
                                '--length': store.length?.toString() ?? null,
                                '--width': store.width?.toString() ?? null,
                            } as React.CSSProperties
                        }
                    >
                        {!store.length ? null : (
                            <div className={cn(styles.measurement__tooltip, styles.yTooltip)}>
                                <span>{toCm(store.length)?.toFixed(1)}</span>
                                <svg
                                    className={styles.measurement__tooltip__arrow}
                                    focusable="false"
                                    aria-hidden="true"
                                    width="12"
                                    height="6"
                                    viewBox="0 0 12 16"
                                >
                                    <path stroke="none" d="M0,0 H12 L6,6 Q6,6 6,6 Z"></path>
                                </svg>
                            </div>
                        )}
                        {!store.width ? null : (
                            <div className={cn(styles.measurement__tooltip, styles.xTooltip)}>
                                <span>{toCm(store.width)?.toFixed(1)}</span>
                                <svg
                                    className={styles.measurement__tooltip__arrow}
                                    focusable="false"
                                    aria-hidden="true"
                                    width="12"
                                    height="6"
                                    viewBox="0 0 12 16"
                                >
                                    <path stroke="none" d="M0,0 H12 L6,6 Q6,6 6,6 Z"></path>
                                </svg>
                            </div>
                        )}
                        <svg
                            preserveAspectRatio="none"
                            width="100%"
                            height="100%"
                            focusable="false"
                            viewBox="0 0 197 540"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M137.335 103.236c-2.051-5.063-4.102-10.127-5.967-14.996-.559.195-1.119.195-1.492.39v13.243c10.257 7.596 19.021 20.06 35.432 16.165v2.531c-2.611.585-5.594 1.948-7.832 1.364-6.527-2.143-13.427-4.285-19.022-7.985-9.324-6.232-18.835-11.685-29.651-13.243-4.289-.585-9.51-.39-12.867 1.752-13.986 8.959-27.6 18.502-40.654 28.629-8.951 6.817-16.597 15.386-25.175 22.786-1.865 1.558-6.154 2.143-7.832.974-3.357-2.532-.933-5.648 1.491-7.985 6.527-6.232 13.24-12.269 19.395-18.696 1.305-1.363 2.424-4.285 2.051-6.038-1.492-6.232-3.357-12.464-5.967-18.112-1.492-2.921-4.662-5.842-7.833-6.816-4.475-1.558-8.205.974-10.63 5.453-6.153 11.685-6.34 24.734-6.9 37.588-.186 3.7 0 7.595 0 11.49-.559.195-1.305.195-1.864.39-.746-3.701-1.679-7.206-2.051-10.907-1.492-11.685-1.12-23.175 2.61-34.276 3.357-9.543 8.02-17.139 19.954-15.775 2.052-15.386 4.476-30.187 24.616-29.019 2.424-16.359 7.646-30.186 26.667-30.381 2.798-11.49 5.968-14.607 16.038-15.775 16.224-1.948 16.784-1.558 21.446 7.595 2.611-5.063 4.662-12.27 9.138-16.359 4.848-4.285 12.121-7.206 18.461-7.206 13.8-.39 25.176 5.843 31.703 19.476 4.475 9.348 8.205 19.28 12.494 28.628 6.714 14.607 3.171 29.213 1.119 44.21-1.119 8.568-1.492 17.527-.186 26.096 3.916 29.018 2.424 57.063-6.341 85.107-8.019 25.708-15.664 51.61-20.7 77.902-4.102 21.423-4.848 43.43-5.967 65.242-2.238 45.378-7.273 90.171-18.648 134.185-5.222 19.865-13.8 37.977-31.516 49.078-24.99 15.775-63.965 16.944-80.002-25.707-2.238-5.843-4.662-11.686-5.595-17.723-4.475-27.655-8.951-54.726-11.375-81.991-3.73-44.599-5.781-89.587-8.765-134.185-1.305-23.565-3.357-47.131-5.035-70.501-.187-2.142 0-4.284 0-7.011 2.424 27.071 5.035 53.557 7.086 80.044 3.544 48.883 5.968 97.766 10.443 146.454 2.238 24.539 7.087 48.688 12.495 72.643 2.424 10.322 8.019 20.449 14.36 28.824 12.867 16.748 38.415 19.67 59.488 8.374 13.613-7.401 22.378-19.281 28.345-33.498 8.392-19.67 11.003-40.703 14.733-61.542 6.9-38.561 7.832-77.706 9.883-116.657 1.865-36.419 9.884-71.669 21.633-105.946 7.272-21.617 13.24-43.43 11.562-66.605-.746-11.296-3.357-22.592-3.357-33.887 0-11.88 1.865-23.955 3.543-35.64 1.305-9.154-.186-17.528-3.73-25.708-3.916-8.958-7.646-18.112-11.748-26.876-7.646-17.138-27.6-22.591-41.027-11.685-1.865 1.558-3.916 4.09-4.475 6.622-1.865 10.322-3.171 20.644-4.662 31.16-1.865 12.66 1.305 24.15 7.086 35.25 2.238 4.285 3.916 8.96 5.408 13.633.746 1.558.186 3.701.186 5.453Zm-40.653-11.1c9.324 1.752 18.648 3.505 27.973 5.063 2.424-13.048 2.051-13.048-2.238-25.123-2.052-5.648-3.73-12.27-2.984-18.112 1.305-10.517-1.678-19.865-5.035-29.408-.56-1.558-2.797-3.7-4.289-3.506-4.849 0-9.884.39-14.546 1.753-5.408 1.558-7.087 7.985-4.29 13.049 8.766 15.385 13.428 31.55 6.528 49.467-.746 2.142-.746 4.674-1.12 6.816-.186-2.142-.745-4.674-.745-7.01.186-5.064 1.865-10.323.932-15.191-1.492-8.764-4.662-17.333-6.9-25.903-1.492-5.647-5.035-6.816-9.883-6.232-8.02.974-12.681 5.843-15.292 13.828-2.424 7.4-4.103 14.411 4.103 19.67 1.864 1.168 3.17 3.31 4.848 4.869 4.29 4.479 5.035 9.348 2.238 15.19-2.051 4.285-3.357 8.959-5.035 13.438.373.39.746.779 1.305.974 8.206-4.674 16.411-9.153 24.43-13.633Zm-49.046 31.939c4.476-3.506 8.02-7.206 12.308-9.153 6.714-3.116 8.392-8.375 10.63-14.996 4.103-12.075 1.865-20.45-8.205-27.85-6.154-4.48-12.681-5.843-17.716-1.169-4.849 4.48-8.02 19.086-5.595 23.76 2.61 5.064 4.662 10.712 6.34 16.165 1.306 3.895 1.492 8.179 2.238 13.243Z"
                                fill="currentColor"
                            ></path>
                        </svg>
                    </div>
                </div>
            </div>
            {withoutSole ? null : (
                <>
                    <div className={styles.recommendedSize}>
                        {t("fitting.Ваш рекомендованный размер")}: <span>{store.recommended ?? '-'}</span>
                    </div>
                    {isWarning ? <div className={styles.warning}>{warning}</div> : null}
                </>
            )}
        </div>
    );
}

const useMobileMediaQuery = () => {
    const mediaQuery = window.matchMedia('screen and (max-width: 1023px)');
    const [match, setMatch] = useState(mediaQuery.matches);

    useEffect(() => {
        const onChange = () => setMatch(mediaQuery.matches);
        mediaQuery.addEventListener('change', onChange);
        return () => mediaQuery.removeEventListener('change', onChange);
    }, [mediaQuery]);

    return match;
};

const getVisible = ({ showOn, isMobile }: Pick<Props, 'showOn'> & { isMobile: boolean }) => {
    switch (showOn) {
        case 'mobile':
            return isMobile;
        case 'desktop':
            return !isMobile;
        default:
            return true;
    }
};

function toCm(valueInMm: number | undefined) {
    if (!valueInMm) return undefined;
    return valueInMm / 10;
}

export default MeasurementsIllustration;
